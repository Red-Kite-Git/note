# HTTP协议详解

http超文本传输协议属于 网络模型的应用层

## 一、请求结构

HTTP 请求由请求行、请求头、空行和请求体四个部分组成。

![网络基础2](E:\CodeLearn\全栈笔记\resources\image\网络基础3.png)

1. **请求行**：包含请求方法、请求的 URI（统一资源标识符）和 HTTP 协议版本。常见的请求方法有 GET、POST、PUT、DELETE 等。例如，GET /index.html HTTP/1.1，表示使用 GET 方法请求服务器上的index.html资源，采用的 HTTP 协议版本为 1.1 。

2. **请求头**：以键值对形式存在，包含了客户端请求的一些附加信息。常见的请求头有：

* **User - Agent**：标识客户端的应用程序类型、操作系统、软件开发商等信息，如Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/[114.0.0.0](http://114.0.0.0/) Safari/537.36。

* **Accept**：告诉服务器客户端能够接收的响应内容类型，如Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed - exchange;v=b3;q=0.7 。

* **Referer**：表示当前请求是从哪个页面链接过来的，用于防盗链等。

* **Cookie**：携带之前服务器设置的 Cookie 信息，用于身份验证等。

3. **空行**：一个单独的 CRLF（回车换行），用于分隔请求头和请求体，标志着请求头的结束。

4. **请求体**：并非所有请求都有请求体，只有 POST、PUT 等方法可能包含。它存放着需要提交给服务器的数据，例如在表单提交时，请求体中会包含用户填写的表单数据。

![网络基础2](E:\CodeLearn\全栈笔记\resources\image\网络基础4.png)

## 二、响应结构

HTTP 响应同样由四个部分组成：状态行、响应头、空行和响应体。

![网络基础2](E:\CodeLearn\全栈笔记\resources\image\网络基础5.png)

1. **状态行**：包含 HTTP 协议版本、状态码和状态码描述。例如，HTTP/1.1 200 OK，表示使用 HTTP/1.1 协议，状态码为 200，说明请求成功，描述为 “OK”。

1. **响应头**：以键值对形式，包含了服务器响应的附加信息。常见的响应头有：

* **Content - Type**：指示响应体的内容类型，如Content - Type: text/html; charset=utf - 8 。

* **Content - Length**：表示响应体的字节长度，用于告诉客户端需要接收多少数据。

* **Set - Cookie**：服务器通过此头向客户端设置 Cookie。

* **Cache - Control**：用于控制缓存策略，如Cache - Control: no - cache表示不使用缓存。

1. **空行**：同样是一个单独的 CRLF，用于分隔响应头和响应体。

1. **响应体**：存放服务器返回给客户端的数据，如 HTML 页面、JSON 数据等。

![网络基础2](E:\CodeLearn\全栈笔记\resources\image\网络基础6.png)

## 三、请求响应步骤

1. **客户端建立连接**：客户端通过 TCP 协议与服务器建立连接，默认使用 80 端口（HTTPS 使用 443 端口）。这一过程通过三次握手实现，客户端发送 SYN 包，服务器返回 SYN + ACK 包，客户端再发送 ACK 包，完成连接建立。

1. **客户端发送请求**：连接建立后，客户端按照 HTTP 请求结构，将请求数据封装好并发送给服务器。

1. **服务器接收请求并处理**：服务器接收到请求后，解析请求行、请求头和请求体，根据请求方法和 URI 确定要执行的操作，如读取文件、查询数据库等。

1. **服务器发送响应**：服务器将处理结果按照 HTTP 响应结构封装成响应数据，发送回客户端。

1. **客户端接收响应并处理**：客户端接收响应数据，解析状态行判断请求是否成功，根据响应头获取相关信息，最后处理响应体中的数据，如渲染 HTML 页面。

1. **关闭连接**：数据传输完成后，客户端和服务器通过四次挥手关闭 TCP 连接。客户端发送 FIN 包，服务器返回 ACK 包，服务器再发送 FIN 包，客户端最后返回 ACK 包。

## 四、浏览器键入URL流程

1. **URL 解析**：浏览器对输入的 URL 进行解析，提取出协议（如 HTTP、HTTPS）、域名、端口（若未指定，HTTP 默认为 80，HTTPS 默认为 443）、路径等信息。

1. **DNS 域名解析**：浏览器首先检查本地 DNS 缓存，如果缓存中有对应的 IP 地址，则直接使用；若没有，浏览器会向本地 DNS 服务器发送查询请求。本地 DNS 服务器若无法解析，会向根 DNS 服务器、顶级域名服务器、权威域名服务器逐级查询，最终获取域名对应的 IP 地址。

1. **建立 TCP 连接**：获取 IP 地址后，浏览器使用 TCP 协议与服务器建立连接，通过三次握手过程建立可靠连接。

1. **发送 HTTP 请求**：连接建立成功后，浏览器按照 HTTP 请求结构构建请求，将请求发送给服务器。

1. **服务器处理请求并返回响应**：服务器接收并处理请求，将结果封装成 HTTP 响应发送回浏览器。

1. **浏览器解析渲染页面**：浏览器接收响应，解析状态行和响应头，若请求成功，根据Content - Type判断响应体类型。如果是 HTML 页面，浏览器会对 HTML 进行解析，构建 DOM 树，同时解析 CSS 样式，构建 CSSOM 树，然后将两者合并成渲染树，进行布局和绘制，最终显示页面。

1. **关闭连接**：页面渲染完成后，浏览器和服务器之间的 TCP 连接可能会保持一段时间（持久连接），以便后续请求使用；也可能关闭连接。

## 五、状态码

HTTP 状态码由三位数字组成，用于表示服务器对请求的处理结果，主要分为以下五类：

1. **1xx（信息性状态码）**：表示服务器已接收请求，需要客户端继续执行操作。例如，100 Continue，表示服务器已收到请求的第一部分，客户端可以继续发送其余部分。

1. **2xx（成功状态码）**：表示请求已成功被服务器接收、理解并处理。常见的有：

* **200 OK**：请求成功，响应体包含请求的资源。

* **201 Created**：用于创建资源的请求（如 POST 请求创建新用户），表示资源已成功创建。

1. **3xx（重定向状态码）**：表示需要客户端采取进一步操作才能完成请求。例如：

* **301 Moved Permanently**：永久重定向，请求的资源已永久移动到新的 URL，浏览器会记住新的 URL。

* **302 Found**：临时重定向，请求的资源临时移动到新的 URL，下次请求仍使用原 URL。

1. **4xx（客户端错误状态码）**：表示客户端的请求有错误。常见的有：

* **400 Bad Request**：客户端请求语法错误，服务器无法理解。

* **401 Unauthorized**：请求需要用户认证，客户端未提供有效的认证信息。

* **403 Forbidden**：服务器拒绝请求，通常是因为客户端没有访问权限。

* **404 Not Found**：请求的资源在服务器上未找到。

1. **5xx（服务器错误状态码）**：表示服务器在处理请求时发生错误。例如：

* **500 Internal Server Error**：服务器内部错误，无法完成请求。

* **503 Service Unavailable**：服务器暂时无法处理请求，可能是服务器过载或正在维护。

## 六、GET与POST

1. **GET**：

* **请求方式**：通常用于获取资源，请求参数附加在 URL 后面，以 “?” 分隔 URL 和参数，多个参数之间用 “&” 连接，如http://example.com/index.html?name=John&age=30。

* **请求体**：一般没有请求体。

* **安全性**：由于参数暴露在 URL 中，不太安全，不适合传输敏感数据。

* **幂等性**：多次相同的 GET 请求对服务器资源的影响是相同的，具有幂等性。

* **缓存**：GET 请求的结果可以被缓存，提高性能。

1. **POST**：

* **请求方式**：常用于向服务器提交数据，如表单提交、文件上传等。请求参数放在请求体中。

* **请求体**：包含要提交的数据。

* **安全性**：相对 GET 更安全，因为数据不在 URL 中显示，但如果没有加密（如未使用 HTTPS），数据仍可能被窃取。

* **幂等性**：多次相同的 POST 请求可能会在服务器上创建多个相同的资源，不具有幂等性。

* **缓存**：POST 请求的结果一般不会被缓存。

## 七、Cookle和Session

1. **Cookie**：

* **概念**：是服务器发送到用户浏览器并保存在本地的一小块数据，用于跟踪用户会话。

* **工作原理**：服务器在响应头中通过Set - Cookie字段向客户端设置 Cookie，客户端后续请求时会在请求头的Cookie字段中携带这些 Cookie 信息发送给服务器。服务器根据 Cookie 识别用户身份、记录用户偏好等。

* **特点**：存储在客户端，有大小限制（一般 4KB 左右），随 HTTP 请求发送，可能会增加请求头的大小。

* **应用场景**：用户登录状态保持、个性化设置（如字体大小、语言）等。

1. **Session**：

* **概念**：存储在服务器端的会话数据，用于跟踪用户会话。

* **工作原理**：客户端第一次请求服务器时，服务器创建一个 Session，并生成一个唯一的 Session ID，通过 Cookie（默认情况）或 URL 重写等方式发送给客户端。客户端后续请求时携带这个 Session ID，服务器根据 Session ID 找到对应的 Session 数据，从而识别用户会话。

* **特点**：存储在服务器端，相对安全，但会占用服务器资源，服务器需要管理 Session 的生命周期。

* **应用场景**：用户登录验证、购物车功能等，需要在多个请求之间保持用户状态的场景。

| **对比维度**     | **GET**                                       | **POST**                                                     |
| ---------------- | --------------------------------------------- | ------------------------------------------------------------ |
| **本质**         | 请求获取资源（幂等性）                        | 提交数据创建 / 更新资源（非幂等性）                          |
| **参数位置**     | URL 中（形如 `?key=value&key2=value2`）       | 请求体（Body）中                                             |
| **参数可见性**   | 明文显示在 URL 中，不安全                     | 不在 URL 显示，需解析请求体（相对隐蔽）                      |
| **数据长度限制** | 受限于 URL 长度（通常浏览器限制约 2000 字符） | 无固定限制（取决于服务器配置）                               |
| **缓存支持**     | 支持自动缓存（可被收藏为书签）                | 不支持自动缓存（需手动设置）                                 |
| **安全性**       | 低（适合非敏感数据，如查询参数）              | 较高（但需配合 HTTPS 才能保证数据加密传输）                  |
| **典型场景**     | 搜索、获取数据（如 `GET /api/users?page=1`）  | 提交表单、上传文件、创建资源（如用户注册）                   |
| **请求示例**     | `GET /index.html?name=Alice&age=25 HTTP/1.1`  | `POST /api/login HTTP/1.1<br>Content-Type: application/x-www-form-urlencoded<br>username=Bob&password=123` |

## 八、http与https

1. **HTTP**：

* **概念**：超文本传输协议，是一种用于在 Web 浏览器和服务器之间传输数据的协议，以明文形式传输数据。

* **特点**：简单快速、灵活，通信开销小，但安全性较差，数据在传输过程中容易被窃取、篡改。

* **端口**：默认使用 80 端口。

1. **HTTPS**：

* **概念**：在 HTTP 基础上加入了 SSL/TLS 加密层，保证数据传输的安全性，是 HTTP 的安全版本。

* **加密原理**：客户端与服务器建立连接后，通过 SSL/TLS 握手过程协商加密算法和密钥。在数据传输过程中，使用协商好的加密算法对数据进行加密和解密，防止数据被窃取和篡改。

* **证书**：服务器需要拥有数字证书，用于验证服务器身份，证书由受信任的证书颁发机构（CA）签发。

* **特点**：安全性高，但由于加密和解密过程会消耗一定的资源，传输效率相对 HTTP 较低，并且需要购买证书，增加了成本。

* **端口**：默认使用 443 端口。

| **对比维度**     | **Cookie**                                                   | **Session**                                                  |
| ---------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **存储位置**     | 客户端（浏览器 / 本地文件）                                  | 服务器端（内存 / 数据库 / 缓存）                             |
| **数据安全性**   | 低（明文存储，易被窃取 / 篡改）                              | 高（数据在服务器端，需通过 Session ID 访问）                 |
| **存储空间限制** | 单个 Cookie 通常 ≤ 4KB，域名总 Cookie ≤ 30 个                | 无固定限制（取决于服务器配置）                               |
| **生命周期**     | 可设置过期时间（持久化 Cookie）或浏览器关闭失效（会话级 Cookie） | 可设置过期时间（如 30 分钟），需服务器主动销毁               |
| **传输方式**     | 每次请求自动携带（请求头 `Cookie` 字段）                     | 通过 Cookie 传递 `Session ID`（默认方式）或 URL 重写         |
| **跨域支持**     | 受同源策略限制（仅同域名可访问）                             | 不受同源策略限制（仅依赖 Session ID 识别）                   |
| **应用场景**     | 存储用户偏好（如语言、主题）、自动登录令牌                   | 登录状态保持、购物车数据、多请求间状态共享                   |
| **优缺点**       | - 优点：减轻服务器压力，支持客户端缓存 - 缺点：安全性低，数据量受限 | - 优点：安全性高，数据可灵活扩展 - 缺点：占用服务器资源，依赖客户端 Cookie（若禁用则需 URL 重写） |
| **协作关系**     | Session 依赖 Cookie 传递 `Session ID`（默认情况下）          | 无 Cookie 时需通过 URL 重写传递 `Session ID`                 |

